<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ profile.name }} - Mail</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/centralfiles/css/mail.css">
  <link rel="stylesheet" href="/static/centralfiles/css/sidebar.css">
</head>
<body>
  <!-- Mobile Menu Toggle -->
  <button class="mobile-menu-toggle" id="mobileMenuToggle">
    <i>â˜°</i>
  </button>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="logo">Knowledge</div>
    
    <div class="nav-section">
      <div class="nav-title">Navigation</div>
      <a href="/files/" class="nav-link">
        <i>ğŸ“</i>
        <span>All Files</span>
      </a>
      <a href="/files/get/{{ profile.cfid }}" class="nav-link">
        <i>ğŸ‘¤</i>
        <span>Profile</span>
      </a>
      {% if profile.is_dianetics_pc %}
      <a href="/files/get/{{ profile.cfid }}/auditing" class="nav-link">
        <i>ğŸ§ </i>
        <span>PC Folder</span>
      </a>
      <a href="/files/get/{{ profile.cfid }}/sessions" class="nav-link">
        <i>ğŸ“‹</i>
        <span>Sessions</span>
      </a>
      <a href="/files/get/{{ profile.cfid }}/scheduling" class="nav-link">
        <i>ğŸ—“ï¸</i>
        <span>Scheduling</span>
      </a>
      {% endif %}
      <a href="/files/get/{{ profile.cfid }}/agreements" class="nav-link">
        <i>ğŸ¤</i>
        <span>Agreements</span>
      </a>
      {% if profile.email_addr %}
      <a href="/files/get/{{ profile.cfid }}/mail" class="nav-link active">
        <i>ğŸ“§</i>
        <span>Mail</span>
      </a>
      {% endif %}
    </div>
    
    <div class="nav-section">
      <div class="nav-title">Tools</div>
      <a href="/files/get/{{ profile.cfid }}/settings" class="nav-link">
        <i>âš™ï¸</i>
        <span>Settings</span>
      </a>
      <a href="/files/get/{{ profile.cfid }}/flags" class="nav-link">
        <i>ğŸš©</i>
        <span>Flags</span>
      </a>
    </div>
  </div>

  <!-- Overlay for mobile -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Page Header -->
    <div class="page-header">
      <div class="page-title">
        <h1>{{ profile.name }}</h1>
        <p>Profile Details & Management</p>
      </div>
      <div class="header-actions">
        <button id="export-btn" class="btn btn-secondary">
          <i>ğŸ“¥</i> Export
        </button>
      </div>
    </div>

    <!-- Profile Header -->
    <div class="profile-header">
      <div class="profile-picture-section">
        <img 
          class="profile-image-large" 
          src="/api/files/{{ profile.cfid }}/profile_icon" 
          alt="{{ profile.name }}"
          onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjYwIiBjeT0iNjAiIHI9IjYwIiBmaWxsPSIjZTllY2VmIi8+CjxwYXRoIGQ9Ik02MCA2NkM2Ni42Mjc0IDY2IDcyIDYwLjYyNzQgNzIgNTRDNzIgNDcuMzcyNiA2Ni42Mjc0IDQyIDYwIDQyQzUzLjM3MjYgNDIgNDggNDcuMzcyNiA0OCA1NEM0OCA2MC42Mjc0IDUzLjM3MjYgNjYgNjAgNjZaIiBmaWxsPSIjNmM3NTdkIi8+CjxwYXRoIGQ9Ik04NCA3OEM4NCA4Mi40MTgzIDgwLjQxODMgODYgNzYgODZINDRDMTkuNTgxNyA4NiA4NCA2OS4xNjUgODQgNzhaIiBmaWxsPSIjNmM3NTdkIi8+Cjwvc3ZnPgo='"
        >
        <button class="change-photo-btn" onclick="changeProfilePicture('{{ profile.cfid }}')">
          Change Photo
        </button>
      </div>
      <div class="profile-info">
        <h2 class="profile-name">{{ profile.name }}</h2>
        <p class="profile-occupation">{{ profile.occupation }}</p>
        <div class="profile-meta">
          <div class="meta-item">
            <i>ğŸ†”</i>
            <span>CFID: {{ profile.cfid }}</span>
          </div>
          <div class="meta-item">
            <i>ğŸ‘¤</i>
            <span>Age: {{ profile.age }}</span>
          </div>
          <div class="meta-item">
            <i>ğŸ”¤</i>
            <span>Pronouns: {{ profile.pronouns.subject_pron }}/{{ profile.pronouns.objective_pron }}</span>
          </div>
        </div>
      </div>
    </div>

    {% if profile.email_addr %}
    <div class="mail-client">
      <div class="mail-header">
        <div class="mail-icon">ğŸ“§</div>
        <div class="mail-header-content">
          <h2>Compose Message</h2>
          <p>Send an email to {{ profile.name }}</p>
        </div>
      </div>
      
      <div class="mail-body">
        <form id="mailForm" class="mail-form">
          <div class="form-group">
            <label for="subject" class="form-label">
              <i>ğŸ“</i> Subject Line
            </label>
            <div class="input-wrapper">
              <span class="input-icon">âœ‰ï¸</span>
              <input 
                type="text" 
                id="subject" 
                name="subject_line" 
                placeholder="What's this about?" 
                required
                maxlength="100"
              >
            </div>
            <div class="char-count" id="subjectCount">0/100</div>
          </div>

          <div class="form-group">
            <label for="message" class="form-label">
              <i>ğŸ’¬</i> Message
            </label>
            <textarea 
              id="message" 
              name="message" 
              placeholder="Write your message here..." 
              required
              maxlength="5000"
            ></textarea>
            <div class="char-count" id="messageCount">0/5000</div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary">
              <i>ğŸ“¤</i> Send Email
            </button>
            <button type="button" class="btn-outline" id="clearBtn">
              <i>ğŸ—‘ï¸</i> Clear
            </button>
          </div>
        </form>
        
        <div id="status" class="status-message" style="display: none;"></div>
      </div>
    </div>
    {% else %}
    <div class="empty-state">
      <i>ğŸ“­</i>
      <p>This user does not have an email address configured.</p>
    </div>
    {% endif %}
  </div>

  <script src="/static/centralfiles/js/mail/mail.js"></script>
  <script src="/static/centralfiles/js/shared/themecontrol.js"></script>
</body>
</html>